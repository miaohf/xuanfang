(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-159019b8"],{"1a46":function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return n}));var s=a("b775");function r(t){return Object(s["a"])({url:"/boxeslist",method:"get",params:t})}function n(t){return Object(s["a"])({url:"/boxeslist2",method:"post",data:t})}},2772:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var s=a("b775");function r(){return Object(s["a"])({url:"/areaitems",method:"get"})}},"2d5d":function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return n}));var s=a("b775");function r(t){return Object(s["a"])({url:"/choices",method:"post",data:t})}function n(t){return Object(s["a"])({url:"/choices",method:"delete",data:t})}},"4bdd":function(t,e,a){},"775b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:"",tag:"section"}},[a("v-snackbar",{attrs:{timeout:t.timeout},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.text)+" ")]),a("v-card",{staticClass:"mt-3 mx-3 px-12 py-6"},[a("v-row",[a("v-col",[a("v-row",{staticClass:"ml-6"},[a("h1",[t._v(" "+t._s(t.customer.name)+" ")]),a("v-row",[a("span",{staticClass:"my-2 mx-3 printstyle"},[t._v(" 抽签顺序号："+t._s(t.customer.lottery_sequence)+" ")]),a("v-icon",[t._v("mdi-map-marker")]),a("span",{staticClass:"my-2 ml-1 mr-3 printstyle"},[t._v(t._s(t.customer.village)+" ")]),t.customer.phone?a("v-icon",[t._v("mdi-phone")]):t._e(),a("span",{staticClass:"my-2 ml-1 mr-3 printstyle"},[t._v(t._s(t.customer.phone)+" ")]),a("span",{staticClass:"my-2 ml-1 mr-3 printstyle"},[t._v("身份证 "+t._s(t.customer.cardid)+"，总面积 "+t._s(t.customer.myarea)+" m² ")])],1)],1)],1),a("v-col",[a("v-row",{staticClass:"d-flex justify-end"},[a("v-btn",{staticClass:"mx-3 mt-5",attrs:{color:"blue"},on:{click:t.getCustomerChoices}},[a("v-icon",{attrs:{left:""}},[t._v("mdi-magnify")]),t._v("查询 ")],1),a("v-btn",{staticClass:"mx-3 mt-5",attrs:{color:"primary"},on:{click:t.resetSelection}},[a("v-icon",{attrs:{left:""}},[t._v("mdi-lock-reset")]),t._v(" 重置 ")],1),a("v-btn",{staticClass:"primary mx-3 mt-5",on:{click:t.goBack}},[a("v-icon",{attrs:{left:""}},[t._v("mdi-arrow-left-bold")]),t._v(" 返回 ")],1)],1)],1)],1),a("v-divider",{staticClass:"my-1"}),a("v-row",[a("v-label",[a("v-chip",{staticClass:"mt-5 ml-8 mr-16",attrs:{label:"",color:t.color,"text-color":"white"}},[a("h3",[t._v(" 选择数量 ")])])],1),a("v-radio-group",{attrs:{row:""},model:{value:t.params.labels_quantity,callback:function(e){t.$set(t.params,"labels_quantity",e)},expression:"params.labels_quantity"}},t._l(t.maxNumberOfChoices,(function(t,e){return a("v-radio",{key:e,staticClass:"grey-label ml-1 mr-3 my-0",attrs:{label:t+" 套",value:t}})})),1)],1),a("v-row",{staticClass:"mb-5"},[a("v-label",[a("v-chip",{staticClass:"mx-8 mr-13",attrs:{label:"",color:t.color,"text-color":"white"}},[a("h3",[t._v(" 多选小区 ")])])],1),t._l(t.gardens[0],(function(e,s){return a("v-checkbox",{key:s,class:"background-"+e.id+" ml-4 my-0",attrs:{multiple:"",value:e.id,label:e.name,"hide-details":"",disabled:t.get_garden_disabled(e)},on:{change:function(e){return t.onCheckboxGardenChanged()}},model:{value:t.checkbox_gardens,callback:function(e){t.checkbox_gardens=e},expression:"checkbox_gardens"}})}))],2),a("v-row",[a("v-label",[a("v-chip",{staticClass:"mx-8 mr-13",attrs:{label:"",color:t.color,"text-color":"white"}},[a("h3",[t._v(" 互斥小区 ")])])],1),a("v-radio-group",{staticClass:"my-0 ml-4",attrs:{row:""},model:{value:t.radio_garden,callback:function(e){t.radio_garden=e},expression:"radio_garden"}},t._l(t.gardens[1],(function(e,s){return a("v-radio",{key:s,class:"background-"+e.id,attrs:{value:e.id,label:e.name},on:{change:function(e){return t.onRadioGardenChanged()}}})})),1)],1),a("v-row",{staticClass:"d-flex justify-start mb-6 px-0"},t._l(t.boxes,(function(e,s){return a("div",{key:s},t._l(e,(function(e){return a("v-badge",{key:e.id,attrs:{bordered:"",icon:"mdi-lock",overlap:"",color:t.get_disabled(e)?t.greyColor:t.greenColor,content:e.free_choice_count,"offset-y":"30"}},[a("v-checkbox",{class:"get_disabled(b) ? greyColor : checkbox-"+t.get_disabled(e)+"-"+e.garden_id+" checkbox-outlined-"+e.deliver_type+" ml-4",attrs:{multiple:"",value:e.id,label:e.name+","+e.area+"m²","hide-details":"",disabled:t.get_disabled(e)},model:{value:t.params.boxes,callback:function(e){t.$set(t.params,"boxes",e)},expression:"params.boxes"}})],1)})),1)})),0)],1),a("v-card",{staticClass:"ma-3 pa-10"},[a("v-row",{staticClass:"d-flex justify-end"},[t.details.choices?a("v-btn",{directives:[{name:"print",rawName:"v-print",value:t.printObj,expression:"printObj"}],staticClass:"primary mr-5",on:{click:t.updateCustomerPrintStatus}},[a("v-icon",{attrs:{left:"",small:""}},[t._v("mdi-printer")]),t._v("打印 ")],1):t._e()],1),a("div",{attrs:{id:"printMe"}},[a("h1",[t._v(" "+t._s(t.customer.name)+" ")]),a("v-row",[a("span",{staticClass:"ma-3 printstyle"},[t._v(" 抽签顺序号："+t._s(t.customer.lottery_sequence)+"； ")]),a("span",{staticClass:"ma-3 printstyle"},[t._v("所在村："+t._s(t.customer.village)+"；")]),a("span",{staticClass:"ma-3 printstyle"},[t._v("电话："+t._s(t.customer.phone)+"；")]),a("span",{staticClass:"ma-3 printstyle"},[t._v("总面积 "+t._s(t.customer.myarea)+" m²；")]),a("span",{staticClass:"ma-3 ml-16 printstyle"},[t._v(" 查询结果仅供参考。 ")]),a("span",{staticClass:"ma-3 printstyle"},[t._v(" 打印时间："+t._s(t.$moment(t.dt_now).format("YYYY-MM-DD HH:mm:ss"))+" ")])]),t.details.choices?a("div",[a("v-row",{staticClass:"d-flex justify-space-between mx-0",staticStyle:{"font-size":"13px"},attrs:{color:"secondary"}},[a("span",[a("span",{staticClass:"noprint"},[t._v(" 满足除最后一套外剩余面积（ >=80可以选取中套，>=20可以选取小套 ）条件的所有方案。 ")])])]),t.details.choices?a("v-divider",{staticClass:"mt-2"}):t._e(),t.details.choices?a("v-simple-table",{attrs:{dense:""},scopedSlots:t._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-right noprint",staticStyle:{width:"60px"}},[t._v(" 序号 ")]),a("th",{staticClass:"text-right noprint",staticStyle:{width:"100px"}},[t._v(" 差额(红为超) ")]),a("th",{staticClass:"text-left noprint"},[t._v(" 预选方案 ")])])]),a("tbody",t._l(t.details.choices,(function(e,s){return a("tr",{key:s},[a("td",{staticClass:"grey--text text-right",staticStyle:{"font-size":"12px"}},[t._v(" "+t._s(s+1)+" ")]),a("td",{staticClass:"text-right"},[e.total_area-t.customer.myarea_remain>0?a("h4",{style:{color:e.total_area-t.customer.myarea_remain>0?"rgb(252, 115, 90)":"rgb(106, 190, 110)"}},[t._v(" +"+t._s((e.total_area-t.customer.myarea_remain).toFixed(2))+" ")]):a("h3",{style:{color:e.total_area-t.customer.myarea_remain>0?"rgb(252, 115, 90)":"rgb(106, 190, 110)"}},[t._v(" "+t._s((e.total_area-t.customer.myarea_remain).toFixed(2))+" ")])]),t._l(e.choices,(function(e,s){return a("td",{key:s,staticClass:"text-left"},[a("v-row",[a("span",{class:"ma-1 text-right choice_background-"+e.garden_id+" box-shadow-"+e.deliver_type+" noprint"},[t._v(" "+t._s(e.box_name)+" ")]),a("span",s<20?{staticClass:"mt-2 text-right",staticStyle:{color:"grey","font-weight":"400"}}:{staticClass:"mt-2 text-right noprint",staticStyle:{color:"grey","font-weight":"400"}},[t._v(" "+t._s(e.garden_name)+" "+t._s(e.area.toFixed(2))+"m² ")])])],1)}))],2)})),0)]},proxy:!0}],null,!1,4236771374)}):t._e()],1):t._e()],1)],1)],1)},r=[],n=(a("99af"),a("4de4"),a("7db0"),a("4160"),a("caad"),a("b0c0"),a("2532"),a("159b"),a("9671")),i=a("1a46"),o=a("d5d5"),c=(a("2d5d"),a("2772")),l={name:"CustomerDetails",components:{},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},data:function(){return{snackbar:!1,text:"",timeout:3e3,dt_now:"",action:{color:"grey",icon:"mdi-checkbox-marked"},color:"#555",icons:{left:"mdi-chevron-left",right:"mdi-chevron-right",info:"mdi-exclamation",success:"mdi-check",warning:"mdi-alert",error:"mdi-close"},greyColor:"#444",greenColor:"#338833",details:{},gardens:[],selected_gardens:[],checkbox_gardens:[],radio_garden:1e3,params:{labels_quantity:1,boxes:[]},maxNumberOfChoices:0,customer:{},boxes:{},boxes_allinone:[],temp:{customer_id:"",labelitems:[]},areaitems_max_area:{},printObj:{id:"printMe",popTitle:"方案列表"}}},computed:{isAdminRole:function(){return!!this.$store.getters.roles.includes("admin")}},created:function(){this.getAreaitems(),this.getCustomer(this.$route.params.id),this.getBoxesByPost(),this.getGardensList(),this.dt_now=Date.now()},methods:{goBack:function(){this.$router.go(-1)},check_params_box:function(t,e){var a=this,s=[1];if(s.includes(t)){var r=this.params.boxes.find((function(e){return a.get_gardenid_from_boxid(e)==t}));if(r&&r!=e.id)return!0}return!1},get_garden_disabled:function(t){return console.log("g.is_restricted, this.customer.has_restricted_house_selection: ",t.is_restricted,this.customer.has_restricted_house_selection),!(!t.is_restricted||!this.customer.has_restricted_house_selection)&&(console.log("is_restricted"),!0)},get_disabled:function(t){return!!(0==t.free_choice_count||this.customer.myarea_remain<20||t.area>=80&&this.customer.myarea_remain<80&&this.areaitems_max_area["小户型"]>this.customer.myarea_remain||t.area>=100&&this.customer.myarea_remain<100&&this.areaitems_max_area["中户型"]>this.customer.myarea_remain||!this.selected_gardens.includes(t.garden_id)||this.check_params_box(t.garden_id,t))},getAreaitems:function(){var t=this;this.listLoading=!0,Object(c["a"])().then((function(e){t.areaitems_max_area=e.data,setTimeout((function(){t.listLoading=!1}),5e3)}))},getCustomer:function(t){var e=this;this.listLoading=!0,Object(n["e"])(t).then((function(t){e.customer=t.data,e.maxNumberOfChoices=Math.ceil((t.data.myarea+20)/80)+1,setTimeout((function(){e.listLoading=!1}),5e3)}))},get_gardenid_from_boxid:function(t){var e=this.boxes_allinone.find((function(e){return e.id===t})).garden_id;return e},onCheckboxGardenChanged:function(){var t=this;this.getBoxesByPost(),this.selected_gardens=[],this.selected_gardens.push(this.radio_garden),this.selected_gardens=this.selected_gardens.concat(this.checkbox_gardens),this.params.boxes=this.params.boxes.filter((function(e){return t.selected_gardens.includes(t.get_gardenid_from_boxid(e))}))},onRadioGardenChanged:function(){var t=this;this.getBoxesByPost(),setTimeout((function(){t.selected_gardens=[],t.selected_gardens.push(t.radio_garden),t.selected_gardens=t.selected_gardens.concat(t.checkbox_gardens)}),100),setTimeout((function(){t.params.boxes=t.params.boxes.filter((function(e){return t.selected_gardens.includes(t.get_gardenid_from_boxid(e))}))}),500)},getBoxesByPost:function(){var t=this;this.listLoading=!0,this.getAreaitems();var e={gardens:this.selected_gardens};Object(i["b"])(e).then((function(e){t.boxes=e.data.items,t.boxes_allinone=e.data.allinonelist,setTimeout((function(){t.listLoading=!1}),3e3)})),console.log("this.params.boxes: ",this.params.boxes)},getGardensList:function(){var t=this;this.listLoading=!0,Object(o["b"])().then((function(e){t.gardens=e.data.items,setTimeout((function(){t.listLoading=!1}),5e3)}))},getCustomerChoices:function(){var t=this;this.listLoading=!0,0==this.params.boxes.length?(this.text="至少选择 1 个【号箱】",console.log(this.text),this.snackbar=!0):Object(n["g"])(this.$route.params.id,this.params).then((function(e){t.details=e.data,t.text="本次操作共查询到 "+e.data.choices.length+" 条记录。",console.log(t.text,t.details),t.snackbar=!0,setTimeout((function(){t.snackbar=!1}),3e3)}))},updateCustomerPrintStatus:function(){var t=this;console.log("xxxxxxxxxxxxxxxxxxxxx");var e={choices_printed:1};Object(n["k"])(this.customer.id,e).then((function(e){console.log(e.data),e.data.error?(t.alert_text=e.data.error,t.alert=!0):(t.text=t.customer.name+" 数据更新完成!",t.snackbar=!0)}))},resetSelection:function(){this.boxes=[],this.getBoxesByPost(),this.selected_gardens=[],this.checkbox_gardens=[],this.radio_garden=[],console.log("resetSelection")},getNamefromOptions:function(t,e){var a="";return t.forEach((function(t){t.key===e&&(a=t.display_name)})),a},getSortClass:function(t){var e=this.listQuery.sort;return e==="+".concat(t)?"ascending":"descending"}}},d=l,u=(a("909e"),a("2877")),m=a("6544"),h=a.n(m),_=a("4ca6"),b=a("8336"),f=a("b0af"),g=a("ac7c"),v=a("cc20"),x=a("62ad"),p=a("a523"),y=a("ce7e"),C=a("132d"),k=a("24c9"),w=a("67b6"),j=a("43a6"),O=a("0fd9"),S=a("1f4f"),V=a("2db4"),B=Object(u["a"])(d,s,r,!1,null,null,null);e["default"]=B.exports;h()(B,{VBadge:_["a"],VBtn:b["a"],VCard:f["a"],VCheckbox:g["a"],VChip:v["a"],VCol:x["a"],VContainer:p["a"],VDivider:y["a"],VIcon:C["a"],VLabel:k["a"],VRadio:w["a"],VRadioGroup:j["a"],VRow:O["a"],VSimpleTable:S["a"],VSnackbar:V["a"]})},"909e":function(t,e,a){"use strict";var s=a("4bdd"),r=a.n(s);r.a},9671:function(t,e,a){"use strict";a.d(e,"h",(function(){return r})),a.d(e,"e",(function(){return n})),a.d(e,"f",(function(){return i})),a.d(e,"g",(function(){return o})),a.d(e,"c",(function(){return c})),a.d(e,"k",(function(){return l})),a.d(e,"d",(function(){return d})),a.d(e,"j",(function(){return u})),a.d(e,"i",(function(){return m})),a.d(e,"a",(function(){return h})),a.d(e,"b",(function(){return _}));var s=a("b775");function r(t){return Object(s["a"])({url:"/customers",method:"get",params:t})}function n(t){return Object(s["a"])({url:"/customers/".concat(t),method:"get"})}function i(t){return Object(s["a"])({url:"/customers/code/".concat(t),method:"get"})}function o(t,e){return Object(s["a"])({url:"/customers/".concat(t,"/choices"),method:"post",data:e})}function c(t){return Object(s["a"])({url:"/customers",method:"post",data:t})}function l(t,e){return Object(s["a"])({url:"/customers/".concat(t),method:"put",data:e})}function d(t){return Object(s["a"])({url:"/customers/".concat(t),method:"delete"})}function u(){return Object(s["a"])({url:"/customerslist",method:"get"})}function m(){return Object(s["a"])({url:"/customers/count",method:"get"})}function h(t){return Object(s["a"])({url:"/customers/callnumber",method:"post",data:t})}function _(t){return Object(s["a"])({url:"/customers/callnumberbycontrol",method:"post",data:t})}},d5d5:function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return n}));var s=a("b775");function r(t){return Object(s["a"])({url:"/gardenslist",method:"get",params:t})}function n(t){return Object(s["a"])({url:"/gardens",method:"get",params:t})}}}]);
//# sourceMappingURL=chunk-159019b8.912e97a2.js.map